#!/bin/bash

# Function to install QEMU
install_qemu() {
    echo "Installing QEMU..."
    pkg install qemu-system-x86_64 -y &>/dev/null
    if [ $? -eq 0 ]; then
        echo "QEMU installed successfully!"
    else
        echo "Failed to install QEMU. Please check your internet connection and try again."
        exit 1
    fi
}

# Function to start the WinEonix emulator
start_emulator() {
    # Run Windows 10 using QEMU on Termux-X11
    qemu-system-x86_64 \
      -name WinEonix \
      -m 4G \
      -cdrom win10.iso \
      -vga std \
      -soundhw hda \
      -device usb-tablet \
      -enable-kvm \
      -display sdl \
      -cpu host \
      -smp $(nproc) \
      -net nic \
      -net user,hostfwd=tcp::3389-:3389 \
      -vnc :1
}

echo "Welcome to WinEonix!"

# Check if QEMU is installed, if not, install it
if ! command -v qemu-system-x86_64 &>/dev/null; then
    install_qemu
fi

# Start the emulator
start_emulator
